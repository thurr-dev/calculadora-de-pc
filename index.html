<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üêú Calculadora de PC by:‡¶î‡ß£Âπ≥∆¨–ΩœÖ—è—èÂíå„ÉÖ 159üêú</title>
	
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #2E8B57; /* VERDE ESCURO */
            color: #E0E0E0; /* Cor do texto principal para contrastar com o fundo escuro */
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: #fff;
            padding: 20px 30px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); /* Sombra mais escura para fundo escuro */
            border: 2px solid #FF0000; /* Borda vermelha para o container principal */
			/* ... seus estilos existentes ... */
/* NOVO: Estilo para o subt√≠tulo "MELEE" */
.subtitle-melee {
    text-align: center; /* Centraliza o texto */
    font-size: 1.2em; /* Deixa o texto um pouco maior */
    font-weight: bold;
    color: #FF0000; /* Cor vermelha para combinar com o t√≠tulo */
    margin-top: -10px; /* Ajusta o espa√ßamento para ficar mais pr√≥ximo do h1 */
    margin-bottom: 20px;
}
/* ... seus estilos existentes ... */
        }
        h1 {
            color: #FF0000; /* vermei para o t√≠tulo principal */
            text-align: center;
        }
        h2 {
            color: #FF6347; /* Vermelho mais suave para subt√≠tulos */
            border-bottom: 2px solid #FF0000; /* Borda vermelha para subt√≠tulos */
            padding-bottom: 5px;
            margin-top: 25px;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
            color: #333; /* Cor do texto da label para contrastar com o fundo branco do container */
        }
        input[type="number"], select {
            width: calc(100% - 22px);
            padding: 10px;
            margin-top: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            color: #333; /* Cor do texto dentro dos inputs */
            background-color: #f9f9f9; /* Fundo levemente diferente para inputs */
        }
        .time-inputs {
            display: flex;
            gap: 10px;
            margin-top: 5px;
        }
        .time-inputs div {
            flex: 1;
        }
        .time-inputs input {
            width: 100%;
            padding: 8px;
        }

        .resultado {
            margin-top: 20px;
            padding: 15px;
            border: 2px solid #FF0000; /* Borda vermelha para resultados normais */
            border-radius: 4px;
            background-color: #ffe0e0; /* Fundo mais claro para resultados */
            color: #333; /* Cor do texto para resultados */
        }
        /* Estilo espec√≠fico para a se√ß√£o de reversa (Se√ß√£o 0) */
        .resultado-reversa {
            margin-top: 20px;
            padding: 15px;
            border: 2px solid #FF0000; /* Borda vermelha para reversa */
            border-radius: 4px;
            background-color: #ffcdd2; /* Fundo mais claro para reversa */
            color: #333; /* Cor do texto para reversa */
        }

        .resultado p {
            margin: 5px 0;
            font-size: 1.1em;
        }
        .pc {
            color: #D32F2F; /* Vermelho mais escuro para PC */
            font-weight: bold;
        }
        .consumo {
            color: #3f51b5;
        }
        .tempo {
            color: #007bff;
            font-weight: bold;
        }
        hr {
            border: 0;
            height: 1px;
            background-color: #FF0000; /* Linha divis√≥ria vermelha */
            margin: 25px 0;
        }
        /* Estilo para os b√¥nus */
        .bonus-section {
            padding: 15px;
            border: 2px dashed #FF0000; /* Borda vermelha pontilhada para b√¥nus */
            border-radius: 5px;
            margin-bottom: 15px;
            background-color: #fce4ec; /* Fundo suave para a se√ß√£o de b√¥nus */
            color: #333; /* Cor do texto para a se√ß√£o de b√¥nus */
        }
        .bonus-section input[type="checkbox"] {
            width: auto;
            margin-right: 5px;
        }
        /* NOVO: Estilo para ocultar o texto de calibra√ß√£o */
        .hidden-calib {
            display: none;
        }

        /* Novo Seletor Tiers */
        .tier-select-container {
            margin-bottom: 20px;
            padding: 15px;
            border: 2px solid #FF0000; /* Borda vermelha para o seletor de Tier */
            border-radius: 8px;
            background-color: #fff8e1; /* Fundo mais claro para o seletor de Tier */
            text-align: center;
            color: #333; /* Cor do texto para o seletor de Tier */
        }
        .tier-select-container select {
            width: 50%;
            min-width: 150px;
            font-size: 1.1em;
            font-weight: bold;
            color: #D32F2F;
        }

        /* Ajuste de cor para texto de par√°grafo no container */
        .container p {
            color: #333;
        }
        .container small {
            color: #555;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üêúCalculadora de PC by:‡¶î‡ß£Âπ≥∆¨–ΩœÖ—è—èÂíå„ÉÖ 159üêú</h1>
	<p class="subtitle-melee">MELEE</p>	
	<div class="tier-select-container">
	
	
	
    <div class="tier-select-container">
        <label for="tierSelect">Selecione o Tipo de Formiga (Tier):</label>
        <select id="tierSelect" onchange="calcularTudo()">
            <option value="">-- Selecione um Tier --</option>
            <option value="T10">T10</option>
            <option value="T11">T11</option>
            <option value="T12">T12</option>
            <option value="T13">T13</option>
        </select>
    </div>
	
    <p id="pcBaseDisplay">Selecione um Tier para ver o PC base.</p>
	
    <hr>
	
    <h2 id="tituloSecao0">‚Ü©Ô∏è Engenharia Reversa (Calibrar com Tempo FINAL do Jogo - TIER) - AUTOM√ÅTICO</h2>
    <p>Insira o tempo com bonus p√≥s guerra e tudo em treinamento e a quantidade de formiga que consegue fazer por vez. O Tempo Base calculado ser√° automaticamente transferido para a Se√ß√£o 1 abaixo.</p>
	
    <label for="quantidadeFormigaReversa">Quantidade de Formigas Treinadas (<span id="reversaTierDisplay1">TIER</span>):</label>
    <input type="number" id="quantidadeFormigaReversa" value="" min="1" oninput="reverterTempo()">

    <label>Tempo FINAL do Jogo (Com b√¥nus - <span id="reversaTierDisplay2">TIER</span>):</label>
    <div class="time-inputs">
        <div>
            <input type="number" id="tempoDiasFinal" value="0" min="0" oninput="reverterTempo()">
            <small>Dias</small>
        </div>
        <div>
            <input type="number" id="tempoHorasFinal" value="0" min="0" max="23" oninput="reverterTempo()">
            <small>Horas</small>
        </div>
        <div>
            <input type="number" id="tempoMinutosFinal" value="0" min="0" max="59" oninput="reverterTempo()">
            <small>Minutos</small>
        </div>
        <div>
            <input type="number" id="tempoSegundosFinal" value="0" min="0" max="59" oninput="reverterTempo()">
            <small>Segundos</small>
        </div>
    </div>
	
    <div id="resultadoReversa" class="resultado-reversa">
        <p>coloque o tempo que aparece com o p√≥s guerra e tudo em treinamento</p>
    </div>

    <hr>

    <h2 id="tituloSecao1">‚û°Ô∏è 1. Calcule a Taxa de Produ√ß√£o e o Tempo Ajustado (TIER)</h2>
    <p>Estes campos s√£o preenchidos automaticamente pela Se√ß√£o 0, mas podem ser modificados manualmente.</p>

    <div class="bonus-section">
        <h3>B√¥nus Ativos (Para C√°lculo do Tempo Ajustado)</h3>
		
        <label>
            <input type="checkbox" id="bonusTreinamento" onchange="calcularTudo()">
            Tudo em Treinamento<span class="hidden-calib"><small class="tempo">(Redu√ß√£o Real Recalibrada: $\mathbf{\approx 3.60\%}$)</small></span>
        </label>
		
        <label>
            <input type="checkbox" id="bonusRecuperacao" onchange="calcularTudo()">
            Recupera√ß√£o P√≥s-Guerra<span class="hidden-calib"><small class="tempo">(Redu√ß√£o Real Calibrada: $\mathbf{\approx 37.31\%}$)</small></span>
        </label>

        <label for="bonusMochila">B√¥nus da Mochila (Redu√ß√£o de Tempo):</label>
        <select id="bonusMochila" onchange="calcularTudo()">
            <option value="0" selected>Nenhum (0%)</option>
            <option value="0.019843">10% exibido (Real: 1.98%)</option>
            <option value="0.0595292">30% exibido (Real: 5.95%)</option>
            <option value="0.0992153">50% exibido (Real: 9.92%)</option>
        </select>
    </div>

    <label for="quantidadeFormiga">Quantidade de Formigas Treinadas (<span id="quantidadeTierDisplay">TIER</span>):</label>
    <input type="number" id="quantidadeFormiga" value="" min="1" oninput="calcularTudo()">

    <label>Tempo Gasto para o Treinamento dessa quantidade (Tempo BASE, sem b√¥nus):</label>
    <div class="time-inputs">
        <div>
            <input type="number" id="tempoDias" value="0" min="0" oninput="calcularTudo()">
            <small>Dias</small>
        </div>
        <div>
            <input type="number" id="tempoHoras" value="0" min="0" max="23" oninput="calcularTudo()">
            <small>Horas</small>
        </div>
        <div>
            <input type="number" id="tempoMinutos" value="0" min="0" max="59" oninput="calcularTudo()">
            <small>Minutos</small>
        </div>
        <div>
            <input type="number" id="tempoSegundos" value="0" min="0" max="59" oninput="calcularTudo()">
            <small>Segundos</small>
        </div>
    </div>
	
    <div id="resultadoQuantidade" class="resultado">
        <p>Insira os valores acima para calcular.</p>
    </div>

    <hr>

    <h2>üéØ 2. Calcular Meta de PC</h2>

    <label for="pcAlvo">Meta de PC Total Desejado:</label>
    <input type="number" id="pcAlvo" value="" min="60" oninput="calcularTudo()">
	
    <div id="resultadoPC" class="resultado">
        <p>Insira o valor do PC desejado para calcular.</p>
    </div>

</div>

<script>
    // --- FATORES DE REDU√á√ÉO CALIBRADOS ---
    const REDUC_TUDO_EM_TREINAMENTO = 0.03597;
    const REDUC_RECUPERACAO_POS_GUERRA = 0.37312;
    const MULT_PC_RECUPERACAO = 1.20;

    // --- CONSTANTES DE CONFIGURA√á√ÉO DE TIERS ---
    const TIER_CONFIG = {
        'T10': {
            PC: 60,
            custos: {
                comida: 421.7721,
                folha: 223.7975,
                agua: 34.3800,
                fungo: 5.5696
            },
            TIME_MULT: 0.8353
        },
        'T11': {
            PC: 80,
            custos: {
                comida: 597.4683,
                folha: 245.0632,
                agua: 59.7468,
                fungo: 11.1898
            },
            TIME_MULT: 1.0
        },
        'T12': {
            PC: 100,
            custos: {
                comida: 774.6835,
                folha: 265.8227,
                agua: 85.5696,
                fungo: 16.7569
            },
            TIME_MULT: 1.24230
        },
        'T13': {
            PC: 125,
            custos: {
                comida: 979.7979,
                folha: 319.6969,
                agua: 119.6969,
                fungo: 28.0000
            },
            TIME_MULT: 3.5213
        }
    };

    // --- FUN√á√ïES DE UTILITY ---

    function convertMinutesToDHMS(totalMinutes) {
        if (totalMinutes <= 0.0001 || isNaN(totalMinutes) || totalMinutes < 0) return '0s';

        let totalSeconds = Math.round(totalMinutes * 60);

        const days = Math.floor(totalSeconds / 86400);
        totalSeconds %= 86400;
		
        const hours = Math.floor(totalSeconds / 3600);
        totalSeconds %= 3600;
		
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
		
        let output = '';
        if (days > 0) output += `${days}d `;
        if (hours > 0) output += `${hours}h `;
        if (minutes > 0) output += `${minutes}m `;
        if (seconds > 0 || output === '') output += `${seconds}s`;
		
        return output.trim();
    }

    function convertDHMS_to_Minutes(d, h, m, s) {
        return (d * 24 * 60) + (h * 60) + m + (s / 60);
    }

    function formatar(numero) {
        if (numero === null || isNaN(numero)) return '0';
        return Math.round(numero).toLocaleString('pt-BR');
    }

    // --- FUN√á√ïES DE C√ÅLCULO DA CALCULADORA ---

    function getCurrentTierConfig() {
        const selectedTier = document.getElementById('tierSelect').value;
        return TIER_CONFIG[selectedTier];
    }
	
    function getPCPerAnt() {
        const tierConfig = getCurrentTierConfig();
        return tierConfig ? tierConfig.PC : 0;
    }

    function getCostsPerAnt() {
        const tierConfig = getCurrentTierConfig();
        return tierConfig ? tierConfig.custos : {};
    }

    function getTempoMultiplicador(isTreinamentoActive, isRecuperacaoActive, descontoMochila) {
        let multiplicadorTempo = 1.0;

        if (isTreinamentoActive) {
            multiplicadorTempo *= (1 - REDUC_TUDO_EM_TREINAMENTO);
        }
        if (isRecuperacaoActive) {
            multiplicadorTempo *= (1 - REDUC_RECUPERACAO_POS_GUERRA);
        }
        if (descontoMochila > 0) {
            multiplicadorTempo *= (1 - descontoMochila);
        }

        return multiplicadorTempo;
    }
	
    function obterTempoTotalEmMinutos(useAdjustedTime) {
        // CORRE√á√ÉO: Usar parseFloat para ler o valor mesmo que o input esteja vazio e retorne ''
        const dias = parseFloat(document.getElementById('tempoDias').value) || 0;
        const horas = parseFloat(document.getElementById('tempoHoras').value) || 0;
        const minutos = parseFloat(document.getElementById('tempoMinutos').value) || 0;
        const segundos = parseFloat(document.getElementById('tempoSegundos').value) || 0;
		
        let tempoBaseMinutos = convertDHMS_to_Minutes(dias, horas, minutos, segundos);
		
        if (useAdjustedTime) {
            const isTreinamentoActive = document.getElementById('bonusTreinamento').checked;
            const isRecuperacaoActive = document.getElementById('bonusRecuperacao').checked;
            const descontoMochila = parseFloat(document.getElementById('bonusMochila').value) || 0;
			
            tempoBaseMinutos *= getTempoMultiplicador(isTreinamentoActive, isRecuperacaoActive, descontoMochila);
        }

        return Math.max(tempoBaseMinutos, 0.0001);
    }


    function getTrainingRate() {
        const Q1 = parseFloat(document.getElementById('quantidadeFormiga').value) || 0; // Use parseFloat e default 0
        if (Q1 <= 0) return 0;
		
        const T_minutos_ajustado = obterTempoTotalEmMinutos(true);
		
        return Q1 / T_minutos_ajustado;
    }

    // --- FUN√á√ÉO DE ENGENHARIA REVERSA (SE√á√ÉO 0) ---
	
    function reverterTempo() {
        const tier = document.getElementById('tierSelect').value;
        const resultadoDiv = document.getElementById('resultadoReversa');
		
        if (!tier) {
            resultadoDiv.innerHTML = `<p style='color: red;'>‚ö†Ô∏è **Selecione um Tipo de Formiga (Tier) primeiro.**</p>`;
            limparTransferencia();
            saveToLocalStorage(); // Salva estado
            return;
        }

        const Q = parseFloat(document.getElementById('quantidadeFormigaReversa').value) || 0;
        const diasFinal = parseFloat(document.getElementById('tempoDiasFinal').value) || 0;
        const horasFinal = parseFloat(document.getElementById('tempoHorasFinal').value) || 0;
        const minutosFinal = parseFloat(document.getElementById('tempoMinutosFinal').value) || 0;
        const segundosFinal = parseFloat(document.getElementById('tempoSegundosFinal').value) || 0;


        // 2. Valida√ß√£o de Inputs da Reversa
        if (Q <= 0 || (diasFinal + horasFinal + minutosFinal + segundosFinal) <= 0) {
            resultadoDiv.innerHTML = `<p style='color: red;'>Essa fun√ß√£o pega o tempo com o p√≥s guerra e tudo em treinamento(${tier}).</p>`;
            limparTransferencia();
            saveToLocalStorage(); // Salva estado
            return;
        }

        const tempoFinalMinutos = convertDHMS_to_Minutes(diasFinal, horasFinal, minutosFinal, segundosFinal);

        const isTreinamentoActive = document.getElementById('bonusTreinamento').checked;
        const isRecuperacaoActive = document.getElementById('bonusRecuperacao').checked;
        const descontoMochila = parseFloat(document.getElementById('bonusMochila').value) || 0;

        const multiplicadorTotal = getTempoMultiplicador(isTreinamentoActive, isRecuperacaoActive, descontoMochila);
		
        if (multiplicadorTotal === 0) {
            resultadoDiv.innerHTML = `<p style='color: red;'>Erro: Multiplicador de tempo √© zero. Verifique as configura√ß√µes de b√¥nus.</p>`;
            limparTransferencia();
            saveToLocalStorage(); // Salva estado
            return;
        }

        const tempoBaseMinutos = tempoFinalMinutos / multiplicadorTotal;

        const tempoBaseDHMS = convertMinutesToDHMS(tempoBaseMinutos);

        // --- TRANSFER√äNCIA AUTOM√ÅTICA (Se for bem-sucedido) ---
        document.getElementById('quantidadeFormiga').value = Q;
        transferirTempoBaseDHMS(tempoBaseMinutos);
        // --- FIM DA TRANSFER√äNCIA AUTOM√ÅTICA ---


        resultadoDiv.innerHTML = `
            <p>‚è≥ Tempo BASE Revertido (sem b√¥nus): ${tempoBaseDHMS}</p>
            <p>Quantidade de Formigas: ${formatar(Q)}</p>
            <p style="color: blue;">Tempo Base de ${tier} transferido automaticamente para a Se√ß√£o 1.</p>
        `;
		
        // CORRE√á√ÉO: Chama calcularTudo() para for√ßar o rec√°lculo das Se√ß√µes 1 e 2.
        calcularTudo();
        saveToLocalStorage(); // Salva estado
    }
	
    function limparTransferencia() {
        // Limpa apenas a quantidade e o Tempo Base da Se√ß√£o 1, mas n√£o o Tempo Final da Se√ß√£o 0
        document.getElementById('quantidadeFormiga').value = ''; // Mantido como string vazia
        document.getElementById('tempoDias').value = 0;
        document.getElementById('tempoHoras').value = 0;
        document.getElementById('tempoMinutos').value = 0;
        document.getElementById('tempoSegundos').value = 0;
    }

    function transferirTempoBaseDHMS(totalMinutes) {
        let totalSeconds = Math.round(totalMinutes * 60);

        const days = Math.floor(totalSeconds / 86400);
        totalSeconds %= 86400;
		
        const hours = Math.floor(totalSeconds / 3600);
        totalSeconds %= 3600;
		
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;

        document.getElementById('tempoDias').value = days;
        document.getElementById('tempoHoras').value = hours;
        document.getElementById('tempoMinutos').value = minutes;
        document.getElementById('tempoSegundos').value = seconds;
    }


    // --- FUN√á√ïES PRINCIPAIS DE C√ÅLCULO (SE√á√ïES 1 E 2) ---

    function updateTierDisplay() {
        const tier = document.getElementById('tierSelect').value;
        const tierConfig = TIER_CONFIG[tier];
		
        if (!tierConfig) {
            document.getElementById('pcBaseDisplay').innerHTML = "Selecione um Tier para ver o PC base.";
            document.getElementById('tituloSecao0').innerHTML = `‚Ü©Ô∏è Engenharia Reversa (Calibrar com Tempo base - TIER) - AUTOM√ÅTICO`;
            document.getElementById('tituloSecao1').innerHTML = `‚û°Ô∏è 1. Coloque a quantidade e o tempo que consegue fazer por vez (TIER)`;
            document.getElementById('reversaTierDisplay1').textContent = 'TIER';
            document.getElementById('reversaTierDisplay2').textContent = 'TIER';
            document.getElementById('quantidadeTierDisplay').textContent = 'TIER';
            return;
        }
		
        let pcBase = tierConfig.PC;
        let pcDisplayText;

        const isRecuperacaoActive = document.getElementById('bonusRecuperacao').checked;

        if (tier === 'T11' && isRecuperacaoActive) {
            pcDisplayText = `PC Base por Formiga ${tier}: ${pcBase} PC (Recupera√ß√£o P√≥s-Guerra N√ÉO afeta o PC da T11).`;
        } else {
            pcDisplayText = `PC Base por Formiga ${tier}: ${pcBase} PC.`;
        }
        document.getElementById('pcBaseDisplay').innerHTML = pcDisplayText;

        document.getElementById('tituloSecao0').innerHTML = `‚Ü©Ô∏è Engenharia Reversa (Calibrar com Tempo base - TIER) - AUTOM√ÅTICO`;
        document.getElementById('tituloSecao1').innerHTML = `‚û°Ô∏è 1.Coloque a quantidade e o tempo que consegue fazer por vez e seleciona os bonus ativos (${tier})`;
		
        document.getElementById('reversaTierDisplay1').textContent = tier;
        document.getElementById('reversaTierDisplay2').textContent = tier;
        document.getElementById('quantidadeTierDisplay').textContent = tier;
    }

    function calcularPorQuantidade() {
        const tier = document.getElementById('tierSelect').value;
        const Q = parseFloat(document.getElementById('quantidadeFormiga').value) || 0; // Garante que Q √© um n√∫mero
        const pcPorFormiga = getPCPerAnt();
        const resultadoDiv = document.getElementById('resultadoQuantidade');
		
        if (!tier) {
            resultadoDiv.innerHTML = `<p style='color: red;'>‚ö†Ô∏è **Selecione um Tipo de Formiga (Tier) primeiro.**</p>`;
            return;
        }

        // CORRIGIDO: Valida√ß√£o do tempo base (sem ajuste) para garantir que o usu√°rio inseriu um tempo.
        const tempoBaseMinutos = convertDHMS_to_Minutes(
            parseFloat(document.getElementById('tempoDias').value) || 0,
            parseFloat(document.getElementById('tempoHoras').value) || 0,
            parseFloat(document.getElementById('tempoMinutos').value) || 0,
            parseFloat(document.getElementById('tempoSegundos').value) || 0
        );
		
        // Verifica se a quantidade E o tempo base foram inseridos
        if (Q <= 0 || tempoBaseMinutos <= 0) {
            resultadoDiv.innerHTML = "<p style='color: red;'>Insira a quantidade de formigas e o tempo base.</p>";
            return;
        }
		
        // O restante do c√°lculo usa o tempo ajustado (com b√¥nus)
        const T_minutos_ajustado = obterTempoTotalEmMinutos(true);
        const pcTotal = Q * pcPorFormiga;

        resultadoDiv.innerHTML = `
            <h3>Resultados de Treinamento (${formatar(Q)} Formigas ${tier}):</h3>
            <p class="pc">‚öîÔ∏è PC Total Alcan√ßado: ${formatar(pcTotal)} PC</p>
            <p class="tempo">‚è≥ Tempo Total de Treinamento (AJUSTADO): ${convertMinutesToDHMS(T_minutos_ajustado)}</p>
        `;
    }

    function calcularPorPC() {
        const tier = document.getElementById('tierSelect').value;
        const pcAlvo = parseFloat(document.getElementById('pcAlvo').value);
        let rate_ants_per_minute_final = getTrainingRate();
        const pcPorFormiga = getPCPerAnt();
        const custos = getCostsPerAnt();
        const resultadoDiv = document.getElementById('resultadoPC');
		
        if (!tier) {
            resultadoDiv.innerHTML = `<p style='color: red;'>‚ö†Ô∏è Selecione um Tipo de Formiga (Tier) primeiro.</p>`;
            return;
        }

        if (isNaN(pcAlvo) || pcAlvo <= 0) {
            resultadoDiv.innerHTML = "<p style='color: red;'>Por favor, insira um PC Alvo v√°lido e positivo.</p>";
            return;
        }
		
        if (pcPorFormiga <= 0) {
            resultadoDiv.innerHTML = `<p style='color: red;'>Erro: PC por formiga inv√°lido. Verifique o Tier selecionado.</p>`;
            return;
        }
		
        if (rate_ants_per_minute_final <= 0) {
            resultadoDiv.innerHTML = `<p style='color: red;'>Erro: Taxa de produ√ß√£o inv√°lida. Complete a Se√ß√£o 1 (Quantidade e Tempo Base).</p>`;
            return;
        }


        const formigasNecessarias = pcAlvo / pcPorFormiga;
        const formigasInteiras = Math.ceil(formigasNecessarias);
        const pcReal = formigasInteiras * pcPorFormiga;

        const tempoTotalEmMinutos = formigasInteiras / rate_ants_per_minute_final;
        const tempoTotalDHMS = convertMinutesToDHMS(tempoTotalEmMinutos);

        const consumoComida = formigasInteiras * (custos.comida || 0);
        const consumoFolha = formigasInteiras * (custos.folha || 0);
        const consumoAgua = formigasInteiras * (custos.agua || 0);
        const consumoFungo = formigasInteiras * (custos.fungo || 0);
		
        resultadoDiv.innerHTML = `
            <h3>Resultados para Meta de PC de ${formatar(pcAlvo)}:</h3>
            <p class="pc">üêú Formigas Necess√°rias: ${formatar(formigasInteiras)} Formigas</p>
            <p>PC Real alcan√ßado: ${formatar(pcReal)} PC</p>
            <p class="tempo">‚è≥ Tempo Total Necess√°rio: ${tempoTotalDHMS}</p>
            <p class="consumo">üí∞ Consumo Total de Recursos:</p>
            <ul>
                <li>Comida: ${formatar(consumoComida)}</li>
                <li>Folha: ${formatar(consumoFolha)}</li>
                <li>√Ågua: ${formatar(consumoAgua)}</li>
                <li>Fungo: ${formatar(consumoFungo)}</li>
            </ul>
        `;
    }

    // Fun√ß√£o √∫nica para recalcular tudo
    function calcularTudo() {
        updateTierDisplay();
        // NOTA: reverterTempo() N√ÉO √© mais chamada aqui. Ela √© chamada APENAS quando h√° input na Se√ß√£o 0.
        // Isso permite que a Se√ß√£o 1 seja preenchida manualmente.
        calcularPorQuantidade();
        calcularPorPC();
        saveToLocalStorage(); // Salva estado
    }

    // =======================================================
    // --- C√ìDIGO PARA ARMAZENAMENTO LOCAL (localStorage) ---
    // =======================================================

    // Lista de IDs dos campos que queremos salvar/carregar
    const INPUT_IDS_TO_SAVE = [
        'tierSelect',
        'quantidadeFormigaReversa',
        'quantidadeFormiga',
        'pcAlvo',
        'tempoDiasFinal',
        'tempoHorasFinal',
        'tempoMinutosFinal',
        'tempoSegundosFinal',
        'tempoDias',
        'tempoHoras',
        'tempoMinutos',
        'tempoSegundos',
        'bonusTreinamento',
        'bonusRecuperacao',
        'bonusMochila'
    ];

    function saveToLocalStorage() {
        INPUT_IDS_TO_SAVE.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                if (element.type === 'checkbox') {
                    localStorage.setItem(id, element.checked);
                } else {
                    localStorage.setItem(id, element.value);
                }
            }
        });
    }

    function loadFromLocalStorage() {
        INPUT_IDS_TO_SAVE.forEach(id => {
            const element = document.getElementById(id);
            const savedValue = localStorage.getItem(id);

            if (element && savedValue !== null) {
                if (element.type === 'checkbox') {
                    // Checkbox armazena 'true' ou 'false' como string
                    element.checked = (savedValue === 'true');
                } else {
                    element.value = savedValue;
                }
            }
        });
    }

    // Fun√ß√£o inicial que garante o estado limpo e inicial da calculadora
    window.onload = function() {
        // 1. Tenta carregar os dados do armazenamento local
        loadFromLocalStorage();

        // 2. Garante que os resultados iniciais estejam limpos/preenchidos
        document.getElementById('resultadoReversa').innerHTML = `<p>coloque o tempo que aparece com o p√≥s guerra e tudo em treinamento</p>`;
        document.getElementById('resultadoQuantidade').innerHTML = `<p>Insira os valores acima para calcular.</p>`;
        document.getElementById('resultadoPC').innerHTML = `<p>Insira o valor do PC desejado para calcular.</p>`;
        
        // 3. Inicializa o display do Tier e recalcula TUDO com os dados carregados
        // Se a se√ß√£o reversa tinha dados salvos, executa a reversa, que chama o calcularTudo()
        const qtdReversa = localStorage.getItem('quantidadeFormigaReversa');
        const diasFinal = parseFloat(localStorage.getItem('tempoDiasFinal')) || 0;
        const horasFinal = parseFloat(localStorage.getItem('tempoHorasFinal')) || 0;
        const minutosFinal = parseFloat(localStorage.getItem('tempoMinutosFinal')) || 0;
        const segundosFinal = parseFloat(localStorage.getItem('tempoSegundosFinal')) || 0;

        if (qtdReversa && parseFloat(qtdReversa) > 0 && (diasFinal + horasFinal + minutosFinal + segundosFinal) > 0) {
            reverterTempo(); // Esta fun√ß√£o j√° chama calcularTudo() e saveToLocalStorage()
        } else {
            calcularTudo(); // Chama o c√°lculo normal para carregar TIER, display e outros campos
        }
    }
</script>

</body>
</html>
